---
# Default values for cloudflare-dns-operator.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 1

image:
  repository: cloudflare-dns-operator
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Automatically mount a ServiceAccount's API credentials?
  automount: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using fullname template
  name: ""

# RBAC configuration
rbac:
  # Specifies whether RBAC resources should be created
  create: true

podAnnotations: {}
podLabels: {}

# Pod Security Context
# Compliant with Pod Security Standards "restricted" profile
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 65532
  runAsGroup: 65532
  fsGroup: 65532
  fsGroupChangePolicy: "OnRootMismatch"
  seccompProfile:
    type: RuntimeDefault

# Container Security Context
# Compliant with Pod Security Standards "restricted" profile
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 65532
  runAsGroup: 65532
  seccompProfile:
    type: RuntimeDefault

service:
  type: ClusterIP
  port: 8080
  targetPort: 8080
  # Metrics port
  metricsPort: 8081

resources:
  limits:
    cpu: 500m
    memory: 128Mi
  requests:
    cpu: 100m
    memory: 64Mi

# Health check configuration
healthChecks:
  enabled: true

  # Liveness probe configuration
  livenessProbe:
    httpGet:
      path: /healthz
      port: 8081
    initialDelaySeconds: 15
    periodSeconds: 20
    timeoutSeconds: 5
    failureThreshold: 3
    successThreshold: 1

  # Readiness probe configuration
  readinessProbe:
    httpGet:
      path: /readyz
      port: 8081
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
    successThreshold: 1

  # Startup probe configuration (for slow-starting containers)
  startupProbe:
    httpGet:
      path: /healthz
      port: 8081
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 30
    successThreshold: 1

# Profiling configuration
profiling:
  # Enable pprof endpoints for debugging (only in development)
  enabled: false
  # Port for profiling endpoints
  port: 6060

nodeSelector: {}

tolerations: []

affinity: {}

# Cloudflare configuration
cloudflare:
  # Cloudflare account email
  email: ""
  # Cloudflare API Token (if not using existing secret)
  apiToken: ""
  # Name of existing secret containing API token
  apiTokenSecretName: ""
  # Key in the secret containing API token
  apiTokenSecretKey: "api-token"  # pragma: allowlist secret
  # Cloudflare Zone ID (optional, can be auto-discovered)
  zoneId: ""

# Secret Management Configuration
secrets:
  # Secret provider: kubernetes, external-secrets-operator, vault
  provider: kubernetes

  # External Secrets Operator configuration
  externalSecretsOperator:
    # Enable External Secrets Operator integration
    enabled: false
    # Secret store configuration
    secretStore:
      name: cloudflare-secret-store
      kind: SecretStore  # SecretStore or ClusterSecretStore
      # Backend type: vault, aws-secrets-manager, azure-keyvault, etc.
      backend: vault
    # Refresh interval for secrets
    refreshInterval: 1h
    # External secret configuration
    externalSecret:
      name: cloudflare-credentials
      # Data mapping from external secret to Kubernetes secret
      dataFrom:
        - extract:
            key: cloudflare/credentials

  # Vault integration configuration
  vault:
    # Enable Vault integration
    enabled: false
    # Vault server address
    address: https://vault.example.com
    # Authentication method: kubernetes, token, approle
    authMethod: kubernetes
    # Vault path for Cloudflare secrets
    path: secret/data/cloudflare
    # Kubernetes auth configuration
    kubernetes:
      role: cloudflare-operator
      serviceAccount: cloudflare-dns-operator
    # Secret rotation
    rotation:
      enabled: false
      schedule: "0 0 * * 0"  # Weekly rotation

  # Secret encryption at rest
  encryption:
    # Enable encryption at rest (requires encrypted etcd)
    enabled: false
    # KMS provider configuration
    kmsProvider: ""

  # Secret access auditing
  auditing:
    # Enable secret access auditing
    enabled: false
    # Audit log destination
    destination: stdout  # stdout, file, syslog

# Operator configuration
operator:
  # Log level (debug, info, warn, error)
  logLevel: info
  # Enable leader election for controller manager
  leaderElection: true
  # Metrics bind address
  metricsBindAddress: ":8081"
  # Health probe bind address
  healthProbeBindAddress: ":8081"
  # Webhook port
  webhookPort: 9443
  # Enable webhook
  enableWebhook: false

# High Availability configuration
highAvailability:
  # Enable High Availability mode
  enabled: false
  # Number of replicas for HA (minimum 2)
  replicaCount: 2

  # Leader election configuration
  leaderElection:
    # Enable leader election (required for HA)
    enabled: true
    # Lease duration (how long leader holds the lease)
    leaseDuration: 15s
    # Renew deadline (time leader has to renew the lease)
    renewDeadline: 10s
    # Retry period (time to wait between lease renewal attempts)
    retryPeriod: 2s
    # Resource name for leader election
    resourceName: cloudflare-dns-operator-leader
    # Resource namespace (empty means same as deployment namespace)
    resourceNamespace: ""

  # Pod anti-affinity for spreading across nodes
  podAntiAffinity:
    # Enable pod anti-affinity
    enabled: true
    # Preferred (soft) or required (hard) anti-affinity
    type: preferred  # preferred or required
    # Weight for preferred anti-affinity
    weight: 100
    # Topology key for anti-affinity
    topologyKey: kubernetes.io/hostname

  # Pod Disruption Budget
  podDisruptionBudget:
    # Enable PodDisruptionBudget
    enabled: true
    # Minimum available pods during disruptions
    minAvailable: 1
    # Alternative: maximum unavailable pods
    # maxUnavailable: 1

  # Graceful shutdown configuration
  gracefulShutdown:
    # Enable graceful shutdown
    enabled: true
    # Termination grace period in seconds
    terminationGracePeriodSeconds: 30
    # Pre-stop hook delay (allows time for load balancer updates)
    preStopDelay: 5s

# CRD installation
crds:
  # Install CRDs as part of the Helm release
  install: true
  # Keep CRDs on chart uninstall
  keep: true

# Pod Security Standards configuration
podSecurityStandards:
  # Enable Pod Security Standards labels on namespace
  enabled: true
  # Create namespace with Pod Security Standards labels
  createNamespace: false
  # Enforce mode - blocks non-compliant pods
  enforce: restricted
  enforceVersion: latest
  # Audit mode - logs policy violations
  audit: restricted
  auditVersion: latest
  # Warn mode - warns about policy violations
  warn: restricted
  warnVersion: latest

# Network Policy configuration
networkPolicy:
  # Enable NetworkPolicy
  enabled: true
  # Prometheus namespace for metrics scraping
  prometheusNamespace: prometheus-system
  # Prometheus pod labels
  prometheusPodLabels:
    app.kubernetes.io/name: prometheus

# Monitoring
monitoring:
  # Enable ServiceMonitor for Prometheus Operator
  serviceMonitor:
    enabled: false
    interval: 30s
    scrapeTimeout: 10s
    labels: {}
    honorLabels: true
    metricRelabelings: []
    relabelings: []

  ingress: []
  egress:
    - ports:
        - port: 443
          protocol: TCP
        - port: 53
          protocol: UDP
        - port: 53
          protocol: TCP

# Security Hardening Configuration
securityHardening:
  # Image security scanning
  imageScanning:
    # Enable image vulnerability scanning
    enabled: false
    # Scanner to use: trivy, snyk, grype
    scanner: trivy
    # Fail on critical vulnerabilities
    failOnCritical: true
    # Severity levels to report: CRITICAL, HIGH, MEDIUM, LOW
    severityLevels:
      - CRITICAL
      - HIGH
    # Ignore specific CVEs
    ignoreCVEs: []

  # Image signing and verification
  imageSigning:
    # Enable image signing verification
    enabled: false
    # Cosign public key for verification
    cosignPublicKey: ""
    # Policy enforcement mode: enforce, warn, disabled
    policyMode: enforce

  # Admission controller policies
  admissionController:
    # Enable admission controller policies
    enabled: false
    # Policy engine: opa, kyverno, polaris
    engine: opa
    # Policy rules
    policies:
      # Require security contexts
      requireSecurityContext: true
      # Disallow privileged containers
      disallowPrivileged: true
      # Require non-root user
      requireNonRoot: true
      # Require read-only root filesystem
      requireReadOnlyRootFS: true

  # Runtime security monitoring
  runtimeSecurity:
    # Enable runtime security monitoring
    enabled: false
    # Runtime security provider: falco, sysdig
    provider: falco
    # Alert on suspicious activity
    alerting:
      enabled: false
      webhook: ""

  # Compliance and benchmarks
  compliance:
    # Enable compliance checking
    enabled: false
    # Benchmarks to check: cis-kubernetes, nsa-kubernetes
    benchmarks:
      - cis-kubernetes
      - nsa-kubernetes
    # Generate compliance reports
    reporting:
      enabled: false
      schedule: "0 0 * * 0"  # Weekly

  # Security monitoring hooks
  monitoring:
    # Enable security event monitoring
    enabled: false
    # Export security metrics
    metrics:
      enabled: false
      port: 9091
    # Security event webhook
    webhook:
      enabled: false
      url: ""

# Horizontal Pod Autoscaler configuration
horizontalPodAutoscaler:
  # Enable HPA
  enabled: false
  # Minimum number of replicas
  minReplicas: 1
  # Maximum number of replicas
  maxReplicas: 10
  # Target CPU utilization percentage
  targetCPUUtilizationPercentage: 80
  # Target memory utilization percentage
  targetMemoryUtilizationPercentage: 80

  # Custom metrics configuration
  customMetrics:
    # Enable custom metrics for HPA decisions
    enabled: false
    # Metrics configuration
    metrics:
      # Queue depth metric (number of pending reconcile requests)
      queueDepth:
        enabled: true
        targetValue: 10
      # Reconcile rate metric (reconciles per second)
      reconcileRate:
        enabled: true
        targetValue: 5
      # Error rate metric (errors per minute)
      errorRate:
        enabled: true
        targetValue: 2
      # API response time metric (milliseconds)
      apiResponseTime:
        enabled: false
        targetValue: 1000

  # HPA behavior configuration (for Kubernetes 1.23+)
  behavior:
    # Scale up behavior
    scaleUp:
      # Policy for scaling up
      policies:
        - type: Percent
          value: 100
          periodSeconds: 60
        - type: Pods
          value: 2
          periodSeconds: 60
      # Stabilization window for scale up
      stabilizationWindowSeconds: 60
      # Select policy with the highest change
      selectPolicy: Max

    # Scale down behavior
    scaleDown:
      # Policy for scaling down
      policies:
        - type: Percent
          value: 10
          periodSeconds: 60
        - type: Pods
          value: 1
          periodSeconds: 60
      # Stabilization window for scale down
      stabilizationWindowSeconds: 300
      # Select policy with the lowest change
      selectPolicy: Min

# Performance tuning configuration
performance:
  # Controller performance settings
  controller:
    # Max concurrent reconciles
    maxConcurrentReconciles: 5
    # Reconcile timeout in seconds
    reconcileTimeout: 300
    # Requeue interval for successful reconciles (seconds)
    requeueInterval: 300
    # Requeue interval for failed reconciles (seconds)
    requeueIntervalOnError: 60

    # Rate limiter configuration
    rateLimiter:
      # Base delay for rate limiter (milliseconds)
      baseDelay: 5
      # Maximum delay for rate limiter (seconds)
      maxDelay: 300
      # Failure threshold before backing off
      failureThreshold: 5
      # Bucket size for token bucket rate limiter
      bucketSize: 100
      # Fill rate for token bucket (tokens per second)
      fillRate: 10

    # Cache configuration
    cache:
      # Cache sync timeout (seconds)
      syncTimeout: 120
      # Resync period for cached objects (seconds)
      resyncPeriod: 600
      # Enable cache metrics
      metricsEnabled: true

    # Batch processing configuration
    batch:
      # Enable batch processing
      enabled: false
      # Batch size for processing multiple resources
      size: 10
      # Batch timeout (milliseconds)
      timeout: 1000
      # Maximum wait time before processing batch (milliseconds)
      maxWait: 5000

  # Resource optimization settings
  resources:
    # CPU optimization
    cpu:
      # Enable CPU profiling
      profilingEnabled: false
      # CPU request multiplier based on load
      requestMultiplier: 1.0
      # CPU limit multiplier based on load
      limitMultiplier: 1.5

    # Memory optimization
    memory:
      # Enable memory profiling
      profilingEnabled: false
      # Memory request multiplier based on load
      requestMultiplier: 1.0
      # Memory limit multiplier based on load
      limitMultiplier: 2.0
      # Enable Go garbage collection tuning
      gcTuning:
        enabled: false
        # Target GC percentage
        gogc: 100
        # Memory limit as percentage of container limit
        memlimit: 90

  # Monitoring and alerting
  monitoring:
    # Enable performance metrics
    metricsEnabled: true
    # Metrics collection interval (seconds)
    metricsInterval: 30
    # Enable custom performance metrics
    customMetrics:
      enabled: true
      # Export interval for custom metrics (seconds)
      exportInterval: 15

    # Alerting thresholds
    alerts:
      # CPU usage alert threshold (percentage)
      cpuThreshold: 85
      # Memory usage alert threshold (percentage)
      memoryThreshold: 90
      # Error rate alert threshold (errors per minute)
      errorRateThreshold: 5
      # Queue depth alert threshold
      queueDepthThreshold: 20
      # API response time alert threshold (milliseconds)
      responseTimeThreshold: 2000

# Multi-tenancy configuration
multitenancy:
  # Enable multi-tenancy features
  enabled: false

  # Deployment scope: cluster, namespace, multi-namespace
  scope: cluster

  # Specific namespaces to watch (only for multi-namespace scope)
  watchNamespaces: []

  # Tenant isolation
  networkPolicies:
    # Enable network policies for tenant isolation
    enabled: false

  # Resource management per tenant
  resourceQuotas:
    # Enable resource quotas for tenants
    enabled: false
    limits:
      # Maximum number of CloudflareRecord resources per namespace
      maxRecords: 100
      # CPU and memory limits for tenant workloads
      cpu: "1000m"
      memory: "512Mi"

  # Tenant validation
  validation:
    # Enforce that CloudflareRecord can only use secrets from same namespace
    enforceNamespaceSecrets: true
    # Validate zone ownership (requires webhook)
    validateZoneOwnership: false
    # Allowed zone patterns per namespace (key: namespace, value: zone patterns)
    allowedZones: {}
    # Example:
    # allowedZones:
    #   tenant-a: ["customer-a.com", "*.customer-a.com"]
    #   tenant-b: ["customer-b.org"]

# Configuration management
config:
  # Enable configuration management via ConfigMap
  enabled: true

  # Configuration format: json, yaml, or individual (separate keys)
  format: yaml

  # Use structured config file (config.json/config.yaml) or individual keys
  file: true

  # Annotations to add to the ConfigMap
  annotations: {}

  # Environment-specific configuration
  environment: production

  # Operator configuration
  operator:
    logLevel: info
    reconcileInterval: "5m"
    metricsBindAddress: ":8080"
    healthProbeBindAddress: ":8081"
    leaderElection: true

  # Cloudflare API configuration
  cloudflare:
    apiTimeout: "30s"
    rateLimitRPS: 10
    retryAttempts: 3
    retryDelay: "1s"

  # Feature flags configuration
  features:
    enableWebhooks: true
    enableMetrics: true
    enableTracing: false
    experimentalFeatures: false
    # Custom feature flags
    customFlags: {}
    # Example:
    # customFlags:
    #   newFeature: true
    #   betaAPI: false

  # Performance tuning configuration
  performance:
    maxConcurrentReconciles: 5
    resyncPeriod: "10m"
    leaderElectionLeaseDuration: "15s"
    leaderElectionRenewDeadline: "10s"
    leaderElectionRetryPeriod: "2s"

  # Custom configuration keys (for individual format)
  custom: {}
  # Example:
  # custom:
  #   specialSetting: "value"
  #   debugMode: "true"
